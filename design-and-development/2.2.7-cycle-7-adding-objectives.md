# 2.2.7 Cycle 7 - Adding objectives

## Overview

After adding a menu, I decided that I would now have to add objectives to the map, this would be in the form of checkpoints that the player would have to drive through. Eventually, I plan to add a clock that will time how long it takes for the user to collect all of the checkpoints. However, that will come in a later cycle.

### Objectives

* [x] Upon loading, spawn checkpoints in random points on the map
* [x] Checkpoints should be in accessible places
* [x] Checkpoints should disappear after being touched
* [x] The car shouldn't collide with the checkpoints

### Key Variables

| Variable Name     | Use                                                     |   |
| ----------------- | ------------------------------------------------------- | - |
| points            | An array containing all of the active points            |   |
| x, y, z           | Position variables of the randomly selected variable    |   |
| mesh              | Three.JS mesh of the checkpoint (rendered as a sphere)  |   |
| point             | Just one of the points that the detection loops through |   |
| vehicle.x, .y, .z | Holds positional information about the vehicle          |   |

### Pseudocode

{% tabs %}
{% tab title="Spawning Checkpoints" %}
```
Function spawnPoints(number, planeGeometry):
    points := []
    For x in range(number):
        randomNumber := random()
        x := PlaneGeometry.points[random].x
        y := PlaneGeometry.points[random].y
        z := PlaneGeometry.points[random].z
        mesh := new THREE.SphereMesh()
        mesh.position = (x, y, z)
        points.append(mesh)
    End For
    Return points
End Function
```
{% endtab %}

{% tab title="Detecting Collisions" %}
```
Function detectCollision(points, vehicle):
    For i in range(points.length):
            point := points[i]
            If (point.x + 2 > vehicle.x - 5 &&
            point.x - 2 < vehicle.x + 5 &&
            point.y + 2 > vehicle.y - 0.5 &&
            point.y - 2 < vehicle.y + 0.5 &&
            point.z + 2 > vehicle.z - 2 &&
            point.z - 2 < vehicle.z + 2):
                  Return point
          End If
  End For
End Function
```
{% endtab %}
{% endtabs %}

## Development

### Outcome



{% tabs %}
{% tab title="/src/spawnPoints.ts" %}
```typescript
import * as THREE from "three";
export function spawnPoints(n: number, planeGeometry: THREE.PlaneGeometry) {
  const points: THREE.Mesh[] = [];
  const pointGeometry = new THREE.SphereGeometry(2);
  const pointMaterial = new THREE.MeshLambertMaterial({ color: 0x0022ff });
  const limits = planeGeometry.attributes.position.array.length / 3;
  for (let i = 0; i < n; i++) {
    const random = Math.floor(Math.random() * limits);
    const x = planeGeometry.attributes.position.array[random * 3];
    const y = planeGeometry.attributes.position.array[random * 3 + 2];
    const z = planeGeometry.attributes.position.array[random * 3 + 1];
    const mesh = new THREE.Mesh(pointGeometry, pointMaterial);
    mesh.position.x = x;
    mesh.position.y = y;
    mesh.position.z = -z;
    points.push(mesh);
  }
  return { points };
}
```
{% endtab %}

{% tab title="/src/detectCollision.ts" %}
```typescript
import type * as THREE from "three";
export function detectCollision(points: THREE.Mesh[], vehicleMesh: THREE.Mesh) {
  for (let i = 0; i < points.length; i++) {
    const point = points[i];
    if (
      point.position.x + 2 > vehicleMesh.position.x - 5 &&
      point.position.x - 2 < vehicleMesh.position.x + 5 &&
      point.position.y + 2 > vehicleMesh.position.y - 0.5 &&
      point.position.y - 2 < vehicleMesh.position.y + 0.5 &&
      point.position.z + 2 > vehicleMesh.position.z - 2 &&
      point.position.z - 2 < vehicleMesh.position.z + 2
    ) {
      return point;
    }
  }
}
```
{% endtab %}
{% endtabs %}

### Challenges

I wasn't able to have the background be a preview of the terrain purely just because it would have to load the terrain twice, once before the menu even showed up. This would cause a big delay at the start of the game and I decided that it just wouldn't be worth it to do that.&#x20;

## Testing

### Tests

| Test | Instructions                            | What I expect                                   | What actually happens |
| ---- | --------------------------------------- | ----------------------------------------------- | --------------------- |
| 1    | Load the game                           | The menu should load instead of the game        | As expected           |
| 2    | Click on "controls" then close the menu | Controls menu should launch and close correctly | As expected           |
| 3    | Click the start button                  | Game should launch as usual                     | As expected           |
| 4    | Play the game                           | Ensure nothing has broken/changed               | As expected           |

### Evidence

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption><p>The Menu upon loading</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption><p>The controls menu appears after opening</p></figcaption></figure>
