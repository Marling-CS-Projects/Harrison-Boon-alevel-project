# 2.2.2 Cycle 2 - Adding physics

## Overview

In this cycle, I will use a library called `cannon-es` to add physics simulation to the game. I will integrate the physics simulation into my game using ThreeJS to render the position of the cannon-es objects in the scene.

In order to test the physics simulation, I will generate a sloped plane and a ball. I will then add gravity to the simulation so that the ball rolls down the plane. I will also include features developed in the last cycle such as the lighting and the 3D rendering using ThreeJS.

To help with visualisation and debugging, I will add orbit controls to the camera so that I will be able to look around and orbit the camera using mouse controls. Similarly, so that I do not have to constantly reset the simulation, if the sphere's height drops below a certain point I will reset it to above the platform.

### Objectives

* [x] Render an inclined plane with a ball on top
* [x] Add cannon-es to simulate phsyics
* [x] Add gravity to the world so that the ball falls
* [x] Add collision detection so that the ball rolls down the plane
* [x] Add orbit controls to the camera
* [x] Teleport the sphere to above the platform if it falls too far

### Key Variables

| Variable Name   | Use                                                                             |   |
| --------------- | ------------------------------------------------------------------------------- | - |
| gravity         | This variable controls the speed at which downwards acceleration occurs.        |   |
| controls        | This variable initiates the ThreeJS orbit controls.                             |   |
| world           | This variable represents the world that the simulated physics takes place in.   |   |
| sphereBody      | Stores information about the sphere's cannon-es physics body.                   |   |
| sphereMesh      | Stores information about the sphere's shape and size.                           |   |
| groundBody      | Stores information about the ground's cannon-es physics body.                   |   |
| planeMesh       | Stores information about the plane that represents the ground's shape and size. |   |
| contactMaterial | Stores information about the contact physics between the sphere and the ground. |   |

### Pseudocode

```
gravity := 9.82
scene := new ThreeJSScene()
camera := new ThreeJSCamera(cameraSettings)
renderer := new ThreeJSRenderer(rendererSettings)
controls := new ThreeJSOrbitControls(orbitControlsSettings)

world := new CannonWorld({gravity: gravity}) 

ambientLight := new AmbientLight(ambientLightSettings)
directionalLight := new DirectionalLight(directionalLightSettings)
camera.position = Vector(5, 5, 5)

// Create a simulated sphere
sphereMaterial := new CannonMaterial()
sphereBody := new CannonBody({
    mass: 1,
    material: sphereMaterial,
    position: Vector(0, 5, 0)
})
sphereBody.addShape(new CannonSphere())
// Create a rendered sphere
sphereMesh := new SphereMesh(sphereSettings)
sphereMesh.position = Vector(0, 5, 0)

// Create the simulated ground
groundMaterial := new CannonGroundMaterial()
groundBody := new CannonBody({
    mass: 0,
    material: groundMaterial
})
groundBody.addShape(new CannonPlane())
groundBody.setEulerRotation(-Math.PI / 4, 0, 0) // Rotate the simulated plane
// Create the rendered plane
planeMesh := new PlaneMesh(planeSettings)
planeMesh.position = groundBody.position
planeMesh.rotation = groundBody.rotation

// Describe how sphere interacts with the plane
contactMaterial := new CannonContactMaterial(
    groundMaterial,
    sphereMaterial,
    materialSettings
)

// Add all rendered objects to the scene
scene.add(sphereMesh)
scene.add(ambientLight)
scene.add(directionalLight)
scene.add(planeMesh)
// Add all simulated bodies to the simulated world
world.addBody(sphereBody)
world.addBody(groundBody)
world.addContactMaterial(contactMaterial)

function animate():
    // Update the rendered sphere to the simulated sphere's position every frame
    sphereMesh.position = sphereBody.position
    sphereMesh.rotation = sphereBody.rotation
    
    requestAnimationFrame(animate)
    renderer.render(scene, camera)
end function
```

## Development

### Outcome

In `/src/index.ts` I added modified the ThreeJS cube object by turning it into a sphere.&#x20;
