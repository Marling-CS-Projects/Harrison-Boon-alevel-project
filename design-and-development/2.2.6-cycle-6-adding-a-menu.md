# 2.2.6 Cycle 6 - Adding a menu & GUI

## Overview

So far the game just launches and starts up when you open the tab in a browser. In order to make it feel a bit more like a game, I plan to add a main menu that will open before the game starts. From here the user should be able to access the settings and also be able to select different modes if I add those later.

### Objectives

* [x] Make the game launch into a menu
* [x] Add a settings button
* [ ] The background of the menu is a preview of the game's terrain
* [x] Add a loading screen while the terrain loads in

### Key Variables

| Variable Name           | Use                                                       |   |
| ----------------------- | --------------------------------------------------------- | - |
| \<div id=menu>          | This is just a flexbox div used for centering the buttons |   |
| \<button id="start">    | This button starts the game and loads up the map          |   |
| \<button id="settings"> | This button loads the settings menu                       |   |
| document.getElementById | Retrieves an HTML element based by its id                 |   |

### Pseudocode

```
startButton.onClick = {
    startGame()
}
settingsButton.onClick = {
    settingsMenu.show()
}
keyDownListener.addEvent({
    If key == "Escape":
        settingsMenu.hide()
})
```

## Development

### Outcome

First, to make sure that the main "index.ts" file was kept tidy and had a single purpose, I move all of the game logic to a separate file in "/src/startGame.ts". I contained it inside of a function so that it could be called when I wanted from the index file. I won't immediately run this function when the game loads, it will only be triggered when the button is pressed.

I then added a menu div&#x20;

{% tabs %}
{% tab title="/src/index.ts" %}
```typescript
import { startGame } from "./startGame";

document.getElementById("start")?.addEventListener("click", () => {
  document.getElementById("start")!.innerHTML = "Loading...";
  document.getElementById("start")!.classList.add("small");
  setTimeout(() => startGame(), 1);
});

document.getElementById("settings")?.addEventListener("click", () => {
  document.getElementById("settings-menu")?.classList.remove("hide");
});
document.addEventListener("keydown", (e) => {
  if (e.key == "Escape") {
    document.getElementById("settings-menu")?.classList.add("hide");
  }
});
```
{% endtab %}

{% tab title="/public/index.html" %}
```html
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div class="menu" id="menu">
    <button id="start">
      <p>Start</p>
    </button>
    <button id="settings">
      <p>Settings</p>
    </button>
  </div>
  <div class="settings menu hide" id="settings-menu"></div>
  <script type="module" src="dist/index.js"></script>
</body>
```
{% endtab %}
{% endtabs %}

### Challenges

The main challenges I faced were related to understanding the CannonES docs and what functions I should use to simulate control of the accelerator and brake pedals. After testing a variety of functions related to movement of the wheels, I settled on the two that I would use.

To generate the terrain, I am currently using CannonES Trimeshes, these work well for collisions with spheres, however CannonES does not support collisions between Trimeshes and other shapes of bodies. This means that the wheels on my car, while appearing like cylinders, will actually be simulated spheres. Similarly, the chassis of my car is a box so it won't be able to collide with the ground terrain. While it was irritating, this issue didn't particularly slow down the development process as the workaround was simple to implement.

## Testing

### Tests

| Test | Instructions                    | What I expect                                                     | What actually happens |
| ---- | ------------------------------- | ----------------------------------------------------------------- | --------------------- |
| 1    | Load the game                   | The game should load without crashing                             | As expected           |
| 2    | Watch the simulation            | There should be a vehicle as well as the ball                     | As expected           |
| 3    | Test the accelerator and brakes | Car should accelerate at reasonable pace and stop appropriately   | As expected           |
| 4    | Test the steering               | Car's front wheels should turn, causing the whole chassis to turn | As expected           |
| 5    | Drive around                    | Collision with terrain shouldn't be too springy / unrealistic     | As expected           |

### Evidence

<figure><img src="../.gitbook/assets/image (10).png" alt=""><figcaption><p>The vehicle spawns correctly and lands on the surface</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption><p>The wheels turn</p></figcaption></figure>
